{"version":3,"sources":["cart.js"],"names":["Cart","appendProducts","getItemsFromLS","bindEvents","setTotal","countTotal","console","log","key","JSON","parse","localStorage","getItem","products","reduce","data","item","index","createProductTemplate","id","picture","name","price","count","document","querySelector","innerHTML","loadProducts","cart","total","items","onclick","cartContainer","addEventListener","target","event","classList","contains","closest","getAttribute","getItemByID","removeItemFromCart","removeItemNode","value","setAttribute","changeCartItemCount","i","length","setItemsToLS","findItemIndex","findIndex","splice","triggerNode","remove","setItem","stringify","init"],"mappings":"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","file":"cart-babel.js","sourcesContent":["// Конструктор корзины\nclass Cart {\n\tinit() {\n\t\tthis.appendProducts(this.getItemsFromLS(\"_cart\"));\n\t\tthis.bindEvents();\n\t\tthis.setTotal(this.countTotal());\n\t\tconsole.log(this.countTotal());\n\t}\n\n\t// Загрузка корзины из localStorage\n\tgetItemsFromLS(key) {\n\t\treturn JSON.parse(localStorage.getItem(key));\n\t}\n\n\t// Составление HTML кода корзины\n\tloadProducts(products) {\n\t\treturn products.reduce((data, item, index) => {\n\t\t\t\tdata += this.createProductTemplate(item, index);\n\t\t\t\treturn data;\n\t\t}, \"\");\n\t}\n\n\t// Создание HTML кода 1 продукта\n\tcreateProductTemplate(item, index) {\n\t\treturn `<div class=\"cart__item\" data-item-id=\"${item.id}\">\n\t\t\t\t\t\t\t<img class=\"cart__item-img\" src=\"${item.picture}\" alt=\"cart\" width=\"100\" height=\"66\">\n\t\t\t\t\t\t\t<p class=\"cart__item-name\">${item.name}</p>\n\t\t\t\t\t\t\t<button class=\"cart__item-remove\">[Remove]</button>\n\t\t\t\t\t\t\t<p class=\"cart__item-price\">£<span>${item.price}.00</span></p>\n\t\t\t\t\t\t\t<input type=\"number\" class=\"cart__items-count\" value=\"${item.count}\">\n\t\t\t\t\t\t</div>`\n\t}\n\n\t// Вставка готовой разметки в HTML\n\tappendProducts(data){\n\t\tdocument.querySelector(\".cart__item-list\").innerHTML = this.loadProducts(data);\n\t}\n\n\t// Рассчёт цены всех предметов в корзине\n\tcountTotal(cart) {\n\t\tcart = cart || this.getItemsFromLS(\"_cart\");\n\t\tlet price = 0;\n\t\treturn cart.reduce((price, item) => {\n\t\t\tprice += item.price * item.count;\n\t\t\treturn price\n\t\t}, 0)\n\t}\n\n\t// Установка выводимой цены\n\tsetTotal(total) {\n\t\tdocument.querySelector(\".cart__total-price span\").innerHTML = total || 0;\n\t}\n\t// Возвращает item по его атрибуту data-item-id\n\tgetItemByID(id, items) {\n\t\treturn items[id];\n\t}\n\n\tbindEvents() {\n\t\tdocument.querySelector(\".cart__checkout\").onclick = () => false;\n\t\tconst cartContainer = document.querySelector(\".cart__item-list\");\n\t\tcartContainer.addEventListener(\"click\", event => {\n\t\t\tconst target = event.target;\n\t\t\tif (target.classList.contains(\"cart__item-remove\")){\n\t\t\t\tconst id = +target.closest(\".cart__item\").getAttribute(\"data-item-id\");\n\t\t\t\tconst item = this.getItemByID(id, this.getItemsFromLS(\"_cart\"));\n\t\t\t\tthis.removeItemFromCart(id);\n\t\t\t\tthis.removeItemNode(target);\n\t\t\t\tthis.setTotal(this.countTotal());\n\t\t\t}\n\t\t});\n\t\tcartContainer.addEventListener(\"blur\", event => {\n\t\t\tconst target = event.target;\n\t\t\tif (target.classList.contains(\"cart__items-count\")){\n\t\t\t\tconst value = target.value;\n\t\t\t\ttarget.setAttribute(\"value\", value);\n\t\t\t\tconst id = +target.closest(\".cart__item\").getAttribute(\"data-item-id\");\n\t\t\t\tthis.changeCartItemCount(id, value);\n\t\t\t\tthis.setTotal(this.countTotal());\n\t\t\t}\n\t\t}, true);\n\t}\n\n\t// Обновление цены и корзины в localStorage при изменении количества предмета\n\tchangeCartItemCount(id, count) {\n\t\tlet cart = this.getItemsFromLS('_cart');\n\t\tfor (var i = 0; i < cart.length; i++) {\n\t\t\tif(id === cart[i].id) {\n\t\t\t\t\tcart[i].count = count;\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.setItemsToLS(\"_cart\", cart);\n\t}\n\n\t// Удаление из корзины по клику кнопки удаления\n\tremoveItemFromCart(id, cart) {\n\t\tcart = cart || this.getItemsFromLS('_cart');\n\t\tconst findItemIndex = cart.findIndex(data => data.id == id);\n\t\tfindItemIndex !== -1 && cart.splice(findItemIndex, 1);\n\t\tthis.setItemsToLS('_cart', cart);\n\t}\n\n\tremoveItemNode(triggerNode) {\n\t\ttriggerNode.closest('.cart__item').remove();\n\t}\n\n\tsetItemsToLS(key, items){\n\t\tlocalStorage.setItem(key, JSON.stringify(items));\n\t}\n\t\n}\n\n\n// // Функционал корзины\n// function cart() {\n// \tvar cart_total = 0;\n// \tvar items;\n\n// \t// Рассчёт цены всех предметов в корзине\n// \tfunction count_total(items) {\n// \t\titems = document.querySelectorAll(\".cart__item\");\n// \t\tvar old_total = cart_total;\n// \t\tcart_total = 0;\n// \t\tfor(var i = 0; i<items.length; i++) {\n// \t\t\tvar price = items[i].querySelector(\".cart__item-price span\").textContent;\n// \t\t\tvar quantity = items[i].querySelector(\".cart__items-count\").value;\n// \t\t\tvar item_total = price*quantity;\n// \t\t\tcart_total += item_total;\n// \t\t};\n// \t}\n\t\n// \t// Установка выводимой цены\n// \tfunction set_total(total) {\n// \t\tdocument.querySelector(\".cart__total-price span\").textContent = total;\n// \t}\n\n// \t// Перерасчёт выводимой цены\n// \tfunction recount_cart() {\n// \t\tcount_total(items);\n// \t\tset_total(cart_total);\n// \t}\n// \trecount_cart();\n\n// \t// Перерасчёт выводимой цены при изменении полей количества\n// \tvar quantity_fields = document.querySelectorAll(\".cart__items-count\");\n// \tfor (var i=0; i<quantity_fields.length; i++) {\n// \t\tquantity_fields[i].addEventListener(\"blur\", recount_cart)\n// \t}\n\n// \t// Удаление из корзины по клику кнопки удаления\n// \tfunction remove_item() {\n// \t\tvar item = this.closest(\".cart__item\");\n// \t\titem.remove();\n// \t\trecount_cart();\n// \t}\n\n// \tvar remove_btns = document.querySelectorAll(\".cart__item-remove\");\n// \tfor (var i=0; i<remove_btns.length; i++) {\n// \t\tremove_btns[i].addEventListener(\"click\", remove_item);\n// \t}\n// };\n\ndocument.addEventListener('DOMContentLoaded', () => {\n\t(new Cart).init();\n});\n"]}